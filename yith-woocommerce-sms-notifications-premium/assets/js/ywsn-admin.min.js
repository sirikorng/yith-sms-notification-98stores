var array_unique_noempty,element_box;jQuery(function(s){var e={};s(".checkbox-column a").click(function(n){n.preventDefault();var a=s(this).attr("id").replace("-lnk",""),c="."+a+"-cb";a in e&&!1!==e[a]?(s(c).prop("checked",!1),e[a]=!1):(s(c).prop("checked",!0),e[a]=!0)});var n=s("#ywsn_sms_gateway");function a(e){s("option",n).each(function(){var n=s("#"+s(this).val().toLowerCase()+"_desc").closest("table"),a=n.prev("h2");s(this).val()===e?(n.show(),a.show(),t(n,!0)):(n.hide(),a.hide(),t(n,!1))})}function c(e){var n=s("#ywsn_from_number").parent().parent().parent(),a=s("#ywsn_from_asid").parent().parent().parent();switch(e){case"YWSN_Jazz":case"YWSN_Trend_Mens":case"YWSN_Bulk_SMS_SA":case"YWSN_Bulk_SMS":case"YWSN_Crystalwebtechs":case"YWSN_Mobily_WS":case"YWSN_Uaedes":n.hide(),a.hide();break;default:n.show(),a.show()}}function t(e,n){s("input",e).each(function(){s(this).prop("required",n)})}void 0!==n&&(a(n.val()),c(n.val())),n.on("change",function(){a(n.val()),c(n.val())}),s(document).ready(function(){"use strict";s("#ywsn_sms_test_message").change(function(){var e=s("option:selected",this).val(),n=s(".ywsn-write-sms");"write-sms"===e?n.show():n.hide()}).change(),s(".ywsn-custom-message").on("change keyup input",function(){var e=s(this).val().length,n=ywsn_admin.sms_length-e,a=s(".ywsn-char-count");a.find("span").text(n),n<0?a.addClass("maxed-out"):a.removeClass("maxed-out")}),element_box.init()}),s("body").on("click","button.ywsn-send-test-sms",function(){var e=s(".ywsn-send-result"),n=s(".ywsn-test-sms").val(),a=s("#ywsn_sms_test_message_country").val(),c=s("#ywsn_sms_test_message").val(),t=s(".forminp-custom-send"),i="";if(t.addClass("processing"),t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.show(),e.removeClass("send-progress send-fail send-success"),""===c)return e.addClass("send-fail"),e.html(ywsn_admin.sms_no_message),void t.removeClass("processing").unblock();switch(c){case"write-sms":i=s(".ywsn-custom-message").val();break;default:i=s("#ywsn_message_"+c).val()}if(""===i)return e.addClass("send-fail"),e.html(ywsn_admin.sms_empty_message),void t.removeClass("processing").unblock();if(""===n)return e.addClass("send-fail"),e.html(ywsn_admin.sms_wrong),void t.removeClass("processing").unblock();var o={action:"ywsn_send_sms",phone:n,message:i,country:a};e.addClass("send-progress"),e.html(ywsn_admin.sms_before_send),s.post(ywsn_admin.ajax_url,o,function(s){e.removeClass("send-progress"),t.removeClass("processing").unblock(),!0===s.success?(e.addClass("send-success"),e.html(ywsn_admin.sms_after_send)):(e.addClass("send-fail"),e.html(s.error))})}).on("click","button.ywsn-send-sms",function(){var e=s(".ywsn-send-result"),n=s(".ywsn-sms-metabox"),a=s("#_ywsn_receive_sms").is(":checked"),c=s(".ywsn-custom-message").val();if(n.addClass("processing"),n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),"requested"!==ywsn_admin.sms_customer_notification||a||window.confirm(ywsn_admin.sms_manual_send_advice)){if(e.show(),e.removeClass("send-progress send-fail send-success"),""===c)return e.addClass("send-fail"),e.html(ywsn_admin.sms_empty_message),void n.removeClass("processing").unblock();var t={action:"ywsn_send_sms",order_id:ywsn_admin.order_id,message:c};e.addClass("send-progress"),e.html(ywsn_admin.sms_before_send),s.post(ywsn_admin.ajax_url,t,function(a){e.removeClass("send-progress"),n.removeClass("processing").unblock(),!0===a.success?(e.addClass("send-success"),e.html(ywsn_admin.sms_after_send)):(e.addClass("send-fail"),e.html(a.error)),s("ul.order_notes").prepend(a.note),s(".ywsn-custom-message").val("")})}else n.removeClass("processing").unblock()}),array_unique_noempty=function(e){var n=[];return s.each(e,function(e,a){(a=s.trim(a))&&-1===s.inArray(a,n)&&n.push(a)}),n},element_box={clean:function(s){return s=s.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"")},parseTags:function(e){var n=e.id.split("-check-num-")[1],a=s(e).closest(".ywcc-checklist-div"),c=a.find(".ywcc-values"),t=c.val().split(","),i=[];return delete t[n],s.each(t,function(e,n){(n=s.trim(n))&&i.push(n)}),c.val(this.clean(i.join(","))),this.quickClicks(a),!1},quickClicks:function(e){var n,a=s(".ywcc-values",e),c=s(".ywcc-value-list ul",e),t=s(e).attr("id");a.length&&(n=a.val().split(","),c.empty(),s.each(n,function(e,n){var a,i;(n=s.trim(n))&&(a=s('<li class="select2-search-choice" />'),(i=s('<a id="'+t+"-check-num-"+e+'" class="select2-search-choice-close" tabindex="0"></a>')).on("click keypress",function(e){"click"!==e.type&&13!==e.keyCode||(13===e.keyCode&&s(this).closest(".ywcc-checklist-div").find("input.ywcc-insert").focus(),element_box.parseTags(this))}),a.prepend('<div><div class="selected-option" data-id="'+n+'">'+n+"</div></div>").prepend(i),c.append(a))}))},flushTags:function(e,n,a){var c,t,i,o=s(".ywcc-values",e),r=s("input.ywcc-insert",e);return void 0!==(i=(n=n||!1)?s(n).text():r.val())&&(t=(c=o.val())?c+","+i:i,t=this.clean(t),t=array_unique_noempty(t.split(",")).join(","),o.val(t),this.quickClicks(e),n||r.val(""),void 0===a&&r.focus(),!1)},init:function(){var e=s(".ywcc-checklist-ajax");s(".ywcc-checklist-div").each(function(){element_box.quickClicks(this)}),s("input.ywcc-insert",e).keyup(function(e){if(13===e.which)return element_box.flushTags(s(this).closest(".ywcc-checklist-div")),!1}).keypress(function(s){if(13===s.which)return s.preventDefault(),!1})}}});